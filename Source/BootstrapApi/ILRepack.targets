<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

    <Target Name="ILRepacker" AfterTargets="Build">
        <ItemGroup>
            <InputAssemblies Include="$(OutputPath)$(AssemblyName).dll"/>
            <InputAssemblies Include="$(OutputPath)Microsoft.Bcl.AsyncInterfaces.dll"/>
            <InputAssemblies Include="$(OutputPath)System.Threading.Channels.dll"/>
            <InputAssemblies Include="$(OutputPath)System.Threading.Tasks.Extensions.dll"/>
        </ItemGroup>

        <ILRepack
                Parallel="true"
                DebugInfo="true"
                AllowDuplicateResources="false"
                XmlDocumentation="true"
                Wildcards="true"
                Internalize="true"
                InputAssemblies="@(InputAssemblies)"
                TargetKind="Dll"
                OutputFile="$(OutputPath)$(AssemblyName).dll"
        />
    </Target>

    <Target Name="CleanMergedDlls"
            AfterTargets="ILRepacker">
        <ItemGroup>
            <FilesToDelete Include="$(OutputPath)Microsoft.Bcl.AsyncInterfaces.dll"/>
            <FilesToDelete Include="$(OutputPath)System.Threading.Channels.dll"/>
            <FilesToDelete Include="$(OutputPath)System.Threading.Tasks.Extensions.dll"/>
        </ItemGroup>

        <Delete Files="@(FilesToDelete)" ContinueOnError="true"/>
        <Message Text="Cleaned up bundled DLLs: @(FilesToDelete)" Importance="high"/>
    </Target>
</Project>